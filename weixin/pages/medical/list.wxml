<view class="content data-v-2b8cf69e"><view class="box data-v-2b8cf69e"><block wx:if="{{!isDoctor}}"><view class="search-section data-v-2b8cf69e"><view class="search-box data-v-2b8cf69e"><uni-icons vue-id="facaa95e-1" type="search" size="20" color="#999" class="data-v-2b8cf69e" bind:__l="__l"></uni-icons><input class="search-input data-v-2b8cf69e" placeholder="搜索兽医、科室、宠物症状" data-event-opts="{{[['input',[['__set_model',['','searchKeyword','$event',[]]],['onSearchInput',['$event']]]]]}}" value="{{searchKeyword}}" bindinput="__e"/></view></view></block><block wx:if="{{isDoctor}}"><view class="doctor-message-center data-v-2b8cf69e"><view class="section-title data-v-2b8cf69e"><text class="data-v-2b8cf69e">患者消息</text></view><view class="message-list data-v-2b8cf69e"><block wx:for="{{patientMessages}}" wx:for-item="message" wx:for-index="__i0__" wx:key="id"><view data-event-opts="{{[['tap',[['replyToPatient',['$0'],[[['patientMessages','id',message.id]]]]]]]}}" class="message-item data-v-2b8cf69e" bindtap="__e"><view class="patient-name data-v-2b8cf69e">{{message.patientName}}</view><view class="message-preview data-v-2b8cf69e">{{message.content}}</view><view class="message-time data-v-2b8cf69e">{{message.time}}</view></view></block><block wx:if="{{$root.g0===0}}"><view class="no-message data-v-2b8cf69e">暂无新消息</view></block></view></view></block><block wx:if="{{!isDoctor}}"><view class="department-section data-v-2b8cf69e"><view class="section-title data-v-2b8cf69e">科室分类</view><scroll-view class="department-scroll data-v-2b8cf69e" scroll-x="true"><view class="department-list data-v-2b8cf69e"><block wx:for="{{departmentList}}" wx:for-item="item" wx:for-index="__i1__" wx:key="id"><view data-event-opts="{{[['tap',[['selectDepartment',['$0'],[[['departmentList','id',item.id,'id']]]]]]]}}" class="{{['department-item','data-v-2b8cf69e',(selectedDepartment===item.id)?'active':'']}}" bindtap="__e"><view class="department-icon data-v-2b8cf69e">{{item.icon}}</view><view class="department-name data-v-2b8cf69e">{{item.name}}</view></view></block></view></scroll-view></view></block><block wx:if="{{!isDoctor}}"><view class="doctor-section data-v-2b8cf69e"><view class="section-title data-v-2b8cf69e">推荐医生</view><view class="doctor-list data-v-2b8cf69e"><block wx:for="{{filteredDoctorList}}" wx:for-item="doctor" wx:for-index="__i2__" wx:key="id"><view data-event-opts="{{[['tap',[['onDoctorTap',['$0'],[[['filteredDoctorList','id',doctor.id]]]]]]]}}" class="doctor-item data-v-2b8cf69e" bindtap="__e"><view class="doctor-avatar data-v-2b8cf69e"><block wx:if="{{doctor.avatarUrl}}"><image class="doctor-avatar-img data-v-2b8cf69e" src="{{doctor.avatarUrl}}" mode="cover"></image></block><block wx:else><view class="doctor-avatar-fallback data-v-2b8cf69e">👩‍⚕️</view></block></view><view class="doctor-info data-v-2b8cf69e"><view class="doctor-name data-v-2b8cf69e">{{''+doctor.name+''}}<block wx:if="{{doctor.online===1}}"><view class="online-status data-v-2b8cf69e">在线</view></block><block wx:else><view class="offline-status data-v-2b8cf69e">离线</view></block></view><view class="doctor-title data-v-2b8cf69e">{{doctor.title}}</view><view class="doctor-department data-v-2b8cf69e">{{doctor.department}}</view><view class="doctor-specialty data-v-2b8cf69e">{{doctor.specialty}}</view><view class="doctor-rating data-v-2b8cf69e"><uni-rate vue-id="{{'facaa95e-2-'+__i2__}}" value="{{doctor.rating}}" size="16" readonly="{{true}}" class="data-v-2b8cf69e" bind:__l="__l"></uni-rate><text class="rating-text data-v-2b8cf69e">{{doctor.rating+"分"}}</text></view></view><view class="doctor-actions data-v-2b8cf69e"><button data-event-opts="{{[['tap',[['startChat',['$0'],[[['filteredDoctorList','id',doctor.id]]]]]]]}}" class="action-btn chat-btn data-v-2b8cf69e" catchtap="__e">在线问诊</button><button data-event-opts="{{[['tap',[['makeAppointment',['$0'],[[['filteredDoctorList','id',doctor.id]]]]]]]}}" class="action-btn appointment-btn data-v-2b8cf69e" catchtap="__e">预约挂号</button></view></view></block></view></view></block></view><uni-popup vue-id="facaa95e-3" type="bottom" mask-click="{{false}}" z-index="{{10080}}" data-ref="chatPopup" class="data-v-2b8cf69e vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="chat-popup data-v-2b8cf69e"><view class="chat-header data-v-2b8cf69e"><block wx:if="{{isDoctor}}"><view class="chat-title data-v-2b8cf69e">{{"与"+currentPatient.patientName+"的对话"}}</view></block><block wx:else><view class="chat-title data-v-2b8cf69e">{{"宠物在线问诊 - "+currentDoctor.name}}</view></block><view class="chat-actions data-v-2b8cf69e"><button data-event-opts="{{[['tap',[['onClearChatTap',['$event']]]]]}}" class="clear-btn data-v-2b8cf69e" bindtap="__e">清空记录</button><view data-event-opts="{{[['tap',[['closeChat',['$event']]]]]}}" class="chat-close data-v-2b8cf69e" bindtap="__e">×</view></view></view><view class="chat-content data-v-2b8cf69e"><scroll-view class="chat-messages data-v-2b8cf69e" scroll-y="true" scroll-top="{{scrollTop}}" scroll-with-animation="true"><block wx:for="{{chatMessages}}" wx:for-item="message" wx:for-index="__i3__" wx:key="id"><view class="{{['message-item','data-v-2b8cf69e',(isDoctor?message.senderType==='doctor':message.senderType==='user')?'message-right':'message-left']}}"><block wx:if="{{message.content}}"><view class="message-content data-v-2b8cf69e">{{message.content}}</view></block><block wx:if="{{message.imageUrl}}"><image class="message-image data-v-2b8cf69e" src="{{baseUrl+'/upload/'+message.imageUrl}}" mode="widthFix" data-event-opts="{{[['tap',[['previewImage',[baseUrl+'/upload/'+message.imageUrl]]]]]}}" bindtap="__e"></image></block><view class="message-time data-v-2b8cf69e">{{message.time}}</view></view></block></scroll-view><view class="chat-input data-v-2b8cf69e"><block wx:if="{{!isDoctor}}"><uni-icons style="margin:0 10rpx;" vue-id="{{('facaa95e-4')+','+('facaa95e-3')}}" type="image" size="28" color="#333" data-event-opts="{{[['^tap',[['chooseImage']]]]}}" bind:tap="__e" class="data-v-2b8cf69e" bind:__l="__l"></uni-icons></block><input class="input-field data-v-2b8cf69e" placeholder="请描述宠物的症状或问题..." adjust-position="{{true}}" cursor-spacing="{{20}}" data-event-opts="{{[['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','inputMessage','$event',[]]]]]]}}" value="{{inputMessage}}" bindconfirm="__e" bindinput="__e"/><button data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" class="send-btn data-v-2b8cf69e" bindtap="__e">发送</button></view></view></view></uni-popup><uni-popup vue-id="facaa95e-5" type="bottom" mask-click="{{false}}" z-index="{{10080}}" data-ref="appointmentPopup" class="data-v-2b8cf69e vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="appointment-popup data-v-2b8cf69e"><view class="appointment-header data-v-2b8cf69e"><view class="appointment-title data-v-2b8cf69e">预约挂号</view><view data-event-opts="{{[['tap',[['closeAppointment',['$event']]]]]}}" class="appointment-close data-v-2b8cf69e" bindtap="__e">×</view></view><view class="appointment-content data-v-2b8cf69e"><view class="form-item data-v-2b8cf69e"><view class="form-label data-v-2b8cf69e">选择日期</view><picker mode="date" value="{{appointmentDate}}" data-event-opts="{{[['change',[['onDateChange',['$event']]]]]}}" bindchange="__e" class="data-v-2b8cf69e"><view class="picker-value data-v-2b8cf69e">{{appointmentDate||"请选择日期"}}</view></picker></view><view class="form-item data-v-2b8cf69e"><view class="form-label data-v-2b8cf69e">选择时间</view><picker mode="selector" range="{{timeSlots}}" value="{{timeIndex}}" data-event-opts="{{[['change',[['onTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-2b8cf69e"><view class="picker-value data-v-2b8cf69e">{{timeSlots[timeIndex]||"请选择时间"}}</view></picker></view><view class="form-item data-v-2b8cf69e"><view class="form-label data-v-2b8cf69e">宠物症状描述</view><textarea class="symptom-input data-v-2b8cf69e" placeholder="请描述宠物的症状、行为异常或不适..." maxlength="200" adjust-position="{{true}}" cursor-spacing="{{20}}" data-event-opts="{{[['input',[['__set_model',['','symptomDescription','$event',[]]]]]]}}" value="{{symptomDescription}}" bindinput="__e"></textarea></view><button data-event-opts="{{[['tap',[['submitAppointment',['$event']]]]]}}" class="submit-btn data-v-2b8cf69e" bindtap="__e">确认预约</button></view></view></uni-popup><block wx:if="{{isDoctor&&!isChatOpen}}"><view class="doctor-tabbar data-v-2b8cf69e"><view data-event-opts="{{[['tap',[['switchTo',['medical']]]]]}}" class="doctor-tabbar-item active data-v-2b8cf69e" bindtap="__e"><image class="tab-icon data-v-2b8cf69e" src="/static/tabs/service_act.png"></image><text class="tab-text data-v-2b8cf69e">问诊</text></view><view data-event-opts="{{[['tap',[['switchTo',['center']]]]]}}" class="doctor-tabbar-item data-v-2b8cf69e" bindtap="__e"><image class="tab-icon data-v-2b8cf69e" src="/static/tabs/mine.png"></image><text class="tab-text data-v-2b8cf69e">我的</text></view></view></block></view>