(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop-order/shop-order"],{"0d57":function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return n}));var n={mescrollUni:function(){return Promise.all([a.e("common/vendor"),a.e("components/mescroll-uni/mescroll-uni")]).then(a.bind(null,"abcf"))}},r=function(){var e=this,t=e.$createElement,a=(e._self._c,e.__map(e.list,(function(t,a){var n=e.__get_orig(t),r=1==t.type?Number(t.price).toFixed(2):null,s=1==t.type?Number(t.total).toFixed(2):null;return{$orig:n,g0:r,g1:s}})));e.$mp.data=Object.assign({},{$root:{l0:a}})},s=[]},"2caf":function(e,t,a){"use strict";(function(e,t){var n=a("47a9");a("35f8");n(a("3240"));var r=n(a("56b5"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(r.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"56b5":function(e,t,a){"use strict";a.r(t);var n=a("0d57"),r=a("e861");for(var s in r)["default"].indexOf(s)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(s);a("a688");var u=a("828b"),i=Object(u["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},"726b":function(e,t,a){"use strict";(function(e){var n=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("7eb4")),s=n(a("ee10")),u={data:function(){return{navlist:["全部","未支付","已支付","已发货","已完成","已取消","已退款"],currentIndex:0,pages:1,list:[],mescroll:null,downOption:{auto:!1},upOption:{page:{},noMoreSize:3,textNoMore:"~ 没有更多了 ~"},hasNext:!0,status:"",user:"",isMerchant:!1}},computed:{baseUrl:function(){return this.$base.url}},onLoad:function(t){if(t&&t.status){var a=this.navlist.indexOf(t.status);this.currentIndex=a>-1?a:0,this.status="全部"===t.status?"":a>-1?t.status:""}try{this.isMerchant="shangjia"===e.getStorageSync("nowTable")}catch(n){}},onShow:function(){var t=this,a=e.getStorageSync("nowTable");this.$api.session(a).then((function(e){t.user=e.data,t.isMerchant="shangjia"===a,t.hasNext=!0,t.mescroll&&t.mescroll.resetUpScroll()}))},methods:{navselect:function(e,t){this.currentIndex=e,this.status="全部"==t?"":"已支付"==t?"已支付":t,this.hasNext=!0,this.mescroll&&this.mescroll.resetUpScroll()},mescrollInit:function(e){this.mescroll=e},downCallback:function(e){this.hasNext=!0,e.resetUpScroll()},upCallback:function(e){var t=this;return(0,s.default)(r.default.mark((function a(){var n,s;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={page:e.num,limit:e.size},t.status&&(n["status"]=t.status),a.next=4,t.$api.page("orders",n);case 4:s=a.sent,1==e.num&&(t.list=[]),t.list=t.list.concat(s.data.list),0==s.data.list.length&&(t.hasNext=!1),e.endSuccess(e.size,t.hasNext);case 9:case"end":return a.stop()}}),a)})))()},onCancelTap:function(t){var a=this;return(0,s.default)(r.default.mark((function n(){var u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:u=a,e.showModal({title:"提示",content:"是否确认退款",success:function(){var a=(0,s.default)(r.default.mark((function a(n){var s,i,c,o,l,f,d;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=e.getStorageSync("nowTable"),!n.confirm){a.next=65;break}return t.status="已退款",a.next=5,u.$api.update("orders",t);case 5:if(a.sent,u.hasNext=!0,u.mescroll&&u.mescroll.resetUpScroll(),1!=t.type){a.next=44;break}if("yonghu"!==s){a.next=15;break}return u.user.money=Number(u.user.money)+Number(t.total),a.next=13,u.$api.update("yonghu",u.user);case 13:a.next=29;break;case 15:if("shangjia"!==s){a.next=29;break}return a.prev=16,a.next=19,u.$api.info("yonghu",t.userid);case 19:if(i=a.sent,!i||!i.data){a.next=25;break}return c=i.data,c.money=Number(c.money||0)+Number(t.total||0),a.next=25,u.$api.update("yonghu",c);case 25:a.next=29;break;case 27:a.prev=27,a.t0=a["catch"](16);case 29:return a.prev=29,a.next=32,u.$api.page("shangjia",{page:1,limit:1,shangjiazhanghao:t.shangjiazhanghao});case 32:if(o=a.sent,!(o&&o.data&&o.data.list&&o.data.list.length>0)){a.next=38;break}return l=o.data.list[0],l.money=Number(l.money||0)-Number(t.total||0),a.next=38,u.$api.update("shangjia",l);case 38:a.next=42;break;case 40:a.prev=40,a.t1=a["catch"](29);case 42:a.next=65;break;case 44:if(2!=t.type){a.next=65;break}if("yonghu"!==s){a.next=51;break}return u.user.jf=Number(u.user.jf)+Number(t.total),a.next=49,u.$api.update("yonghu",u.user);case 49:a.next=65;break;case 51:if("shangjia"!==s){a.next=65;break}return a.prev=52,a.next=55,u.$api.info("yonghu",t.userid);case 55:if(f=a.sent,!f||!f.data){a.next=61;break}return d=f.data,d.jf=Number(d.jf||0)+Number(t.total||0),a.next=61,u.$api.update("yonghu",d);case 61:a.next=65;break;case 63:a.prev=63,a.t2=a["catch"](52);case 65:case"end":return a.stop()}}),a,null,[[16,27],[29,40],[52,63]])})));return function(e){return a.apply(this,arguments)}}()});case 2:case"end":return n.stop()}}),n)})))()},orderDiscuss:function(e){this.$utils.jump("../discuss"+e.tablename+"/add-or-update?refid="+e.goodid)},goDetail:function(e){e&&e.logistics&&this.$utils.jump("./logistics?id="+e.id)},logistics:function(e){this.$utils.jump("./logistics?id="+e.id)},returnGood:function(t){var a=this;return(0,s.default)(r.default.mark((function n(){var u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:u=a,e.showModal({title:"提示",content:"是否确认退货",success:function(){var a=(0,s.default)(r.default.mark((function a(n){var s,i,c,o,l,f,d;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=e.getStorageSync("nowTable"),!n.confirm){a.next=65;break}return t.status="已退款",a.next=5,u.$api.update("orders",t);case 5:if(a.sent,u.hasNext=!0,u.mescroll&&u.mescroll.resetUpScroll(),1!=t.type){a.next=44;break}if("yonghu"!==s){a.next=15;break}return u.user.money=u.user.money+t.total,a.next=13,u.$api.update("yonghu",u.user);case 13:a.next=29;break;case 15:if("shangjia"!==s){a.next=29;break}return a.prev=16,a.next=19,u.$api.info("yonghu",t.userid);case 19:if(i=a.sent,!i||!i.data){a.next=25;break}return c=i.data,c.money=Number(c.money||0)+Number(t.total||0),a.next=25,u.$api.update("yonghu",c);case 25:a.next=29;break;case 27:a.prev=27,a.t0=a["catch"](16);case 29:return a.prev=29,a.next=32,u.$api.page("shangjia",{page:1,limit:1,shangjiazhanghao:t.shangjiazhanghao});case 32:if(o=a.sent,!(o&&o.data&&o.data.list&&o.data.list.length>0)){a.next=38;break}return l=o.data.list[0],l.money=Number(l.money||0)-Number(t.total||0),a.next=38,u.$api.update("shangjia",l);case 38:a.next=42;break;case 40:a.prev=40,a.t1=a["catch"](29);case 42:a.next=65;break;case 44:if(2!=t.type){a.next=65;break}if("yonghu"!==s){a.next=51;break}return u.user.jf=u.user.jf+t.total,a.next=49,u.$api.update("yonghu",u.user);case 49:a.next=65;break;case 51:if("shangjia"!==s){a.next=65;break}return a.prev=52,a.next=55,u.$api.info("yonghu",t.userid);case 55:if(f=a.sent,!f||!f.data){a.next=61;break}return d=f.data,d.jf=Number(d.jf||0)+Number(t.total||0),a.next=61,u.$api.update("yonghu",d);case 61:a.next=65;break;case 63:a.prev=63,a.t2=a["catch"](52);case 65:case"end":return a.stop()}}),a,null,[[16,27],[29,40],[52,63]])})));return function(e){return a.apply(this,arguments)}}()});case 2:case"end":return n.stop()}}),n)})))()},cancel:function(t){var a=this;return(0,s.default)(r.default.mark((function n(){var u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:u=a,e.showModal({title:"提示",content:"是否取消订单",success:function(){var e=(0,s.default)(r.default.mark((function e(a){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a.confirm){e.next=7;break}return t.status="已取消",e.next=4,u.$api.update("orders",t);case 4:e.sent,u.hasNext=!0,u.mescroll&&u.mescroll.resetUpScroll();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 2:case"end":return n.stop()}}),n)})))()},pay:function(t){var a=this;return(0,s.default)(r.default.mark((function n(){var u,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:u=a,i=e.getStorageSync("nowTable"),e.showModal({title:"提示",content:"是否支付订单",success:function(){var e=(0,s.default)(r.default.mark((function e(a){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a.confirm){e.next=25;break}if(1!=t.type){e.next=12;break}if(!(u.user.money-t.total<0)){e.next=5;break}return u.$utils.msg("余额不足，请先充值"),e.abrupt("return");case 5:return u.$utils.msgBack("支付成功"),u.user.money=u.user.money-t.total,(u.user.jf||0==u.user.jf)&&(u.user.jf=parseFloat(u.user.jf)+parseFloat(t.total)),e.next=10,u.$api.update(i,u.user);case 10:e.next=20;break;case 12:if(2!=t.type){e.next=20;break}if(!(u.user.jf-t.total<0)){e.next=16;break}return u.$utils.msg("积分不足，兑换商品失败"),e.abrupt("return");case 16:return u.$utils.msgBack("兑换成功"),u.user.jf=u.user.jf-t.total,e.next=20,u.$api.update(i,u.user);case 20:return t.status="已支付",e.next=23,u.$api.update("orders",t);case 23:e.sent,u.mescroll&&u.mescroll.resetUpScroll();case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 3:case"end":return n.stop()}}),n)})))()},onConfirm:function(t){var a=this;return(0,s.default)(r.default.mark((function n(){var u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:u=a,e.showModal({title:"提示",content:"是否确认收货",success:function(){var a=(0,s.default)(r.default.mark((function a(n){return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.getStorageSync("nowTable"),!n.confirm){a.next=8;break}return t.status="已完成",a.next=5,u.$api.update("orders",t);case 5:a.sent,u.hasNext=!0,u.mescroll&&u.mescroll.resetUpScroll();case 8:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()});case 2:case"end":return n.stop()}}),n)})))()},ship:function(t){var a=this;return(0,s.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("shangjia"===e.getStorageSync("nowTable")){n.next=2;break}return n.abrupt("return");case 2:return t.status="已发货",n.next=5,a.$api.update("orders",t);case 5:a.hasNext=!0,a.mescroll&&a.mescroll.resetUpScroll();case 7:case"end":return n.stop()}}),n)})))()}}};t.default=u}).call(this,a("df3c")["default"])},a688:function(e,t,a){"use strict";var n=a("cdd2"),r=a.n(n);r.a},cdd2:function(e,t,a){},e861:function(e,t,a){"use strict";a.r(t);var n=a("726b"),r=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(s);t["default"]=r.a}},[["2caf","common/runtime","common/vendor"]]]);